<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.davizn.model.interfaces.NoteDAO">
   
   <!--노트 데이터 추가-->
   <insert id="addNoteData" parameterType="String">
      insert into note 
      (dataseq,datatype,filepath) 
      values(
            (select dataseq 
               from (select rownum r,dataseq from personaldata order by dataseq desc)
            where r = 1),1,#{filepath})
   </insert>
   
   
   <!--노트 추가 후 삭제-->
   <select id="detailNoteData" resultType="kr.or.davizn.model.dto.PersonalDataNoteDTO">
      select n.dataseq, n.filepath, p.dataname, p.datacreate
      from personaldata p join note n
      on p.dataseq = n.dataseq
      where p.dataseq=(
                           (select dataseq from
                               (select rownum r, dataseq from note order by dataseq desc)
                            where r=1)
                       )
   </select>
   
   <!--목록에서 상세 조회-->
   <select id="detailNote" resultType="kr.or.davizn.model.dto.PersonalDataNoteDTO">
      select n.dataseq, n.filepath, p.dataname, p.datacreate, p.strgseq
      from personaldata p join note n
      on p.dataseq=n.dataseq
      where n.dataseq=#{dataseq}
   </select>
    
   <!--노트 데이터 수정(기존 정보 확인)-->
   <select id="modifyNote" resultType="kr.or.davizn.model.dto.PersonalDataNoteDTO">
      select *
      from personaldata p join note n
      on p.dataseq = n.dataseq
      where p.dataseq=#{dataseq}
   </select>
   
   <!--노트 데이터 수정 (파일 overwrite)-->
   <select id="selectOneNote" resultType="kr.or.davizn.model.dto.NoteDTO">
      select dataseq, datatype, filepath from note where dataseq=#{dataseq}
   </select>
   
   <!--노트 데이터 삭제-->
   <delete id="deleteNote">
      delete from note where dataseq=#{dataseq}
   </delete>
</mapper>