<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.davizn.dataInterface.ScheduleDAO">
	
	<!--개인 저장소에 일정 데이터 추가-->
	<insert id="createPersonalData">
		insert into personaldata values(data_seq.nextval,#{param1},#{param2},4,sysdate)
	</insert>
	
	<!--일정 데이터 추가-->
	<insert id="createSchedule" parameterType="kr.or.davizn.dataDTO.ScheduleDTO">
		insert into schedule(dataseq,datatype,schcontext,startdate,finaldate,alramdate,priority,state)
		values((select nvl(max(dataseq),0) from personaldata),
			4,#{schcontext},
		 	To_date(#{startdate},'MM/DD/YYYY HH24:MI'),
		 	To_date(#{finaldate},'MM/DD/YYYY HH24:MI'),
		 	To_date(#{alramdate, jdbcType=VARCHAR},'MM/DD/YYYY HH24:MI'),
		 	#{priority},#{state})
	</insert>
	
	<!--현재 진행 중인 일정 리스트-->
	<select id="currentSchedule" resultType="kr.or.davizn.dataDTO.PersonaldataSchDTO">
	<![CDATA[ 	
		select p.dataname, s.startdate, s.finaldate, s.priority, p.dataseq, p.strgseq
		from personaldata p join schedule s
		on p.dataseq=s.dataseq
		where (finaldate-sysdate)>=0 and strgseq=#{strgseq}
	]]> 	
	</select>
	
	<!--종료한 일정 리스트-->
	<select id="endSchedule" resultType="kr.or.davizn.dataDTO.PersonaldataSchDTO">
	<![CDATA[ 
		select p.dataname, s.startdate, s.finaldate, s.priority, p.dataseq, p.strgseq
		from personaldata p join schedule s
		on p.dataseq=s.dataseq
		where (finaldate-sysdate)<0 and strgseq=#{strgseq}
	]]> 
	</select>
	
	<!--일정 상세보기-->
	<select id="detailSchedule" resultType="kr.or.davizn.dataDTO.PersonaldataSchDTO">
		select p.dataname, s.schcontext,s.startdate,s.finaldate,
			   s.alramdate,s.priority,p.dataseq,p.strgseq
				from personaldata p join schedule s
				on p.dataseq = s.dataseq
				where p.dataseq=#{param1}
	</select>
	
	<!--일정 삭제하기-->
	<delete id="deleteSchedule">
		delete from personaldata where dataseq=#{dataseq}
	</delete>
	
	<!--개인 데이터(일정 수정하기)-->
	<update id="updatePersonalDate">
		update personaldata set dataname=#{param1} where dataseq=#{param2}
	</update>
	
	<update id="updateSchedule" parameterType="kr.or.davizn.dataDTO.ScheduleDTO">
		update schedule set schcontext=#{schcontext},
                    startdate=To_date(#{startdate},'MM/DD/YYYY HH24:MI'),
                    finaldate=To_date(#{finaldate},'MM/DD/YYYY HH24:MI'),
                    alramdate=To_date(#{alramdate, jdbcType=VARCHAR},'MM/DD/YYYY HH24:MI'),
                    priority=#{priority}
	</update>
	
</mapper>